<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Signature protocols :: RP API integration guidance - DRAFT</title>
    <link rel="canonical" href="https://sk-eid.github.io/smart-id-documentation/smart-id-documentation/3.0.0/signature_protocols.html">
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://sk-eid.github.io/smart-id-documentation">RP API integration guidance - DRAFT</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="smart-id-documentation" data-version="3.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="introduction.html">RP API documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="glossary.html">Terms and glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="changes.html">Changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="sessions.html">Session types</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="authentication_session.html">Authentication session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="signing_session.html">Signing session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="certificatechoice_session.html">Certificate choice session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="session_status.html">Session status</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dynamic_link_flows.html">Dynamic link flows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="notification_based_flows.html">Notification-based flows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="response_verification.html">Response verification</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="object_references.html">REST object references</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="signature_protocols.html">Signature protocols</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interactions.html">Interactions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="request_properties.html">Additional request properties</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="api_details.html">REST API details</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secure.html">Secure Implementation Guide</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RP API documentation</span>
    <span class="version">3.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="introduction.html">RP API documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="introduction.html">3.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="introduction.html">RP API documentation</a></li>
    <li><a href="signature_protocols.html">Signature protocols</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="file:///C:/Users/kristjan.jalukse/GIT-SK/sid-docs/docs/RP_API_documentation/modules/ROOT/pages/signature_protocols.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Signature protocols</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The RP API&#8217;s main use case is to provide digital signatures which is enabled by use of signature protocols.</p>
</div>
<div class="paragraph">
<p>The signature protocol <code>ACSP_V1</code> is used for authentication requests and <code>RAW_DIGEST_SIGNING</code> signature protocol for signing.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="acsp_v1"><a class="anchor" href="#acsp_v1"></a><code>ACSP_V1</code> signature protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authentication Context Signature Protocol version 1 makes the signature non-replayable by adding a server-side component to the signed object.</p>
</div>
<div class="paragraph">
<p>The RP must provide the digest algorithm to use as well a challenge it needs signed. The challenge must be generated anew for every single authentication request.</p>
</div>
<div class="paragraph">
<p>It must be remembered by the RP for the duration of the authentication session, and later it is used to reconstruct and validate the signed authentication data structure.</p>
</div>
<div class="paragraph">
<p>The recommended way of generating the challenge this is to use the Java SecureRandom
class<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>
or equivalent method in other programming languages, to generate a
random value for each new authentication request. For example, the
following code snippet generates 64 random bytes and computes the hash
value and encodes it in Base64.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SecureRandom random = new SecureRandom();
byte randBytes[] = new byte[64];
random.nextBytes(randBytes);
MessageDigest md = MessageDigest.getInstance("SHA-512");
md.update(randBytes);
byte[] hash = md.digest();
byte[] randomChallenge = Base64.encodeBase64(hash);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the <code>randomChallenge</code> must be recorded in the current user&#8217;s
session for later comparison.</p>
</div>
<table id="acsp_v1_param" class="tableblock frame-none grid-none stripes-odd stretch">
<caption class="title">Signature parameters for authentication request with signature protocol ACSP_V1</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 71.4287%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digestAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digest algorithm used to compute the digest from the <code>ACSP_V1</code> data structure. See section <a href="#digest_algorithms">Digest algorithms</a> for more details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">randomChallenge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a random value of 64 bytes encoded with base64, which is generated per each authentication session at the RP side. See above for details.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table describes the signature body for
<code>ACSP_V1</code> protocol that the RP will receive in the session response. Notice that the actual
object that was signed is not present&#8201;&#8212;&#8201;it needs to be compiled by the RP using the previously sent
<code>randomChallenge</code> and the <code>serverRandom</code> returned in this response. This re-constructed
object must then be used to validate the signature.</p>
</div>
<table class="tableblock frame-none grid-none stripes-odd stretch">
<caption class="title">Signature body for ACSP_V1 in session response</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature value, base64 encoded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signatureScheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature creation scheme  that was used for creating the signature. See <a href="#signature_schemes">Signature schemes</a>. <strong>NOTE: Some details <em>will</em> change for this field</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digestAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digest algorithm that was used by RP to compute the digest. See <a href="#digest_algorithms">Digest algorithms</a>. <strong>NOTE: Some details <em>will</em> change for this field</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serverRandom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A random value of bytes encoded with base64, which are generated at RP API service side.
This value will be returned from RP API and Relying Parties must use it exactly as it was returned during the validation of signature.
There are not any guarantees that the returned value length is the same in each call of the RP API.
Expected length is in the range between 64 and 128 bytes,
encoded as base64.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">ACSP_V1 signature</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "signatureProtocol": "ACSP_V1",
  "signature": {
    "value": "C+C9XVjIAZnCHH9vfBSv...",
    "signatureScheme": "RSASSA-PKCS1-v1_5",
    "digestAlgorithm": "SHA-512",
    "serverRandom": "B+C9XVjIAZnCHH9vfBSv..."
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the <code>signature.value</code> the RP client must reconstruct its input digest (hash) and calculate it themselves. The digest is calculated over the concatenation of the <code>signatureProtocol</code>, the base64 of the <code>serverRandom</code> and the base64 of the <code>randomChallenge</code> separated by semicolons:</p>
</div>
<div class="paragraph">
<p><code>digest(signatureProtocol + ";" + base64(serverRandom) +  ";" + base64(randomChallenge))</code></p>
</div>
<div class="paragraph">
<p>Note that <code>signature.serverRandom</code> in the response and the <code>randomChallenge</code> in the initial request are already base64 encoded.</p>
</div>
<div class="paragraph">
<p>The digest algorithm to use is specified in <code>signature.digestAlgorithm</code>. The signature scheme that was used to generate the signature based on the digest is specified in <code>signature.signatureScheme</code>.</p>
</div>
<div class="paragraph">
<p>Full verification of the signature and response is described in <a href="response_verification.html" class="xref page">Response verification</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="raw_digest_signing"><a class="anchor" href="#raw_digest_signing"></a><code>RAW_DIGEST_SIGNING</code> signature protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>RAW_DIGEST_SIGNATURE</code> signature protocol allows direct signing of the digest that is requested by the RP.</p>
</div>
<div class="paragraph">
<p>The RP must provide the digest algorithm to use as well the digest hash that is being signed. In case an electronic signature is being created this is calculated from the electronic signature container.</p>
</div>
<table id="raw_digest_signing_param" class="tableblock frame-none grid-none stripes-odd stretch">
<caption class="title">Signature parameters for signing request with signature protocol RAW_DIGEST_SIGNATURE</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64 encoded digest to be signed (<a href="https://datatracker.ietf.org/doc/html/rfc4648">RFC 4648</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digestAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The digest algorithm that has been applied by the RP to the message to obtain the digest (prior to making the request to the signing endpoint). See <a href="#digest_algorithms">Digest algorithms</a>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stripes-odd stretch">
<caption class="title">Signature body for RAW_DIGEST_SIGNATURE in session response</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature value, base64 encoded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signatureScheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature creation scheme  that was used for creating the signature. See <a href="#signature_schemes">Signature schemes</a>. <strong>NOTE: Some details <em>will</em> change for this field</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digestAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digest algorithm that was used by RP to compute the digest. See <a href="#digest_algorithms">Digest algorithms</a>. <strong>NOTE: Some details <em>will</em> change for this field</strong></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">RAW_DIGEST_SIGNATURE signature</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "signatureProtocol": "RAW_DIGEST_SIGNATURE",
  "signature": {
    "value": "B+A9CfjIBZnDHHav3B4F...",
    "signatureScheme": "RSASSA-PSS",
    "digestAlgorithm": "SHA-256",
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="signature_schemes"><a class="anchor" href="#signature_schemes"></a>Signature schemes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Smart-ID supports both the current <code>RSASSA-PSS</code> signature scheme as well as the legacy <code>RSASSA-PKCS1-v1_5</code> as defined in <a href="https://datatracker.ietf.org/doc/html/rfc8017#section-8">RFC 8017, section 8</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Not all client applications have yet been upgraded to the latest versions that support <code>RSASSA-PSS</code>. Therefore, the Smart-ID service may return a signature created using the <code>RSASSA-PKCS1-v1_5</code> signature scheme even if the RP client requested <code>RSASSA-PSS</code>. The signature scheme is clearly indicated in the <code>signatureScheme</code> field in the response.</p>
</div>
<div class="paragraph">
<p>All client applications are expected to support the <code>RSASSA-PSS</code> signature scheme starting with January 2025 the latest.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="digest_algorithms"><a class="anchor" href="#digest_algorithms"></a>Digest algorithms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Smart-ID supports signature operations based on three algorithms from the SHA-2 family: <code>SHA-256</code>, <code>SHA-384</code> and <code>SHA-512</code>.</p>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. See <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/security/SecureRandom.html" class="bare">https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/security/SecureRandom.html</a>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
