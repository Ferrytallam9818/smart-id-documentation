<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dynamic link flows :: RP API integration guidance - DRAFT</title>
    <link rel="canonical" href="https://sk-eid.github.io/smart-id-documentation/rp-api/3.0.0_dev/dynamic_link_flows.html">
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://sk-eid.github.io/smart-id-documentation">RP API integration guidance - DRAFT</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rp-api" data-version="3.0.0_dev">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="introduction.html">RP API documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="glossary.html">Terms and glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="changes.html">Changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="sessions.html">Session types</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="authentication_session.html">Authentication session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="signing_session.html">Signing session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="certificatechoice_session.html">Certificate choice session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="session_status.html">Session status</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="dynamic_link_flows.html">Dynamic link flows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="notification_based_flows.html">Notification-based flows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="response_verification.html">Response verification</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="object_references.html">REST object references</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="signature_protocols.html">Signature protocols</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interactions.html">Interactions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="request_properties.html">Additional request properties</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="api_details.html">REST API details</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secure.html">Secure Implementation Guide</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RP API documentation</span>
    <span class="version">3.0.0_dev</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="introduction.html">RP API documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="introduction.html">3.0.0_dev</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="introduction.html">RP API documentation</a></li>
    <li><a href="dynamic_link_flows.html">Dynamic link flows</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Dynamic link flows</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On a high level, the dynamic flow consists of the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>User interacts with a RP frontend (which is a webpage or an app).</p>
</li>
<li>
<p>RP backend makes a request to RP-API to create a dynamic link based authentication or signing session, obtaining security parameters that are necessary for generating dynamic links. This request may either be anonymous (no personal identifier is provided) or non-anonymous.</p>
</li>
<li>
<p>RP starts dynamically creating dynamic links that update each second. The dynamic links are generated in RP backend and forwarded to RP frontend.</p>
</li>
<li>
<p>RP frontend displays the QR codes / Web2App links / App2App links. The user interacts with one of them by either:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Opening Smart-ID app and scanning a QR code;</p>
</li>
<li>
<p>Clicking on a Web2App link in a RP webpage, thus opening the Smart-ID app;</p>
</li>
<li>
<p>Clicking on an App2App link in a RP app, thus opening the Smart-ID app.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Smart-ID app extracts the necessary parameters and makes a request to the Smart-ID backend to check the integrity, validity and timeliness of the dynamic link. If the request was non-anonymous, it is verified that the provided personal identifier agrees with the actual user&#8217;s identity. Backend responds by creating a transaction and returning the transaction data.</p>
</li>
<li>
<p>Signing protocol continues in the usual way (user enters the PIN code).</p>
</li>
<li>
<p>After the signature has been given, the RP receives the success result via the session status endpoint. In the case of anonymous flow, RP learns the identity of the user only at this point (via the user&#8217;s certificate).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following diagram describes the dynamic link based flow for the authentication session. The flow for the signing session follows the same principles and has been omitted.</p>
</div>
<div class="literalblock sequence kroki-error">
<div class="content">
<pre>''
'' Cyber theme based on the mars theme from future-architect/puml-themes
''
'' Original Author: [future-architect](https://github.com/future-architect)
'' Source: [future-architect/puml-themes](https://github.com/future-architect/puml-themes/tree/master/themes)
'' License: [Apache License, Version 2.0](https://github.com/future-architect/puml-themes/blob/master/LICENSE)
''

'' Cybernetica branding colors
!$WHITE = "#FFFFFF"
!$BLACK = "#202020"
!$DARK_GREY = "#989898"
!$GREY = "#DFDFDF"
!$LIGHT_GREY = "#F2F2F2"
!$GREEN = "#0C5F19"
!$CYBER_GREEN = "#B7F6C1"
!$GREEN_DARKER10 = "#91F1A0"
!$GREEN_DARKER25 = "#58EA6F"
!$GREEN_DARKER50 = "#18BF32"
!$GREEN_DARKER75 = "#0C5F19"
!$GREEN_DARKER90 = "#05260A"
!$RED = "#AC0101"
!$CYBER_RED = "#FE5D5D"
!$RED_LIGHTER80 = "#FFDFDF"
!$RED_LIGHTER60 = "#FFBEBE"
!$RED_LIGHTER40 = "#FE9E9E"
!$RED_DARKER25 = "#FD0707"
!$RED_DARKER50 = "#AC0101"
!$YELLOW = "#B38B00"
!$CYBER_YELLOW = "#FFDD68"
!$YELLOW_LIGHTER80 = "#FFF8E1"
!$YELLOW_LIGHTER60 = "#FFF1C3"
!$YELLOW_LIGHTER40 = "#FFEBA4"
!$YELLOW_DARKER25 = "#FFC90E"
!$YELLOW_DARKER50 = "#B38B00"
!$PURPLE = "#5F1BFD"
!$CYBER_PURPLE = "#A078FE"
!$PURPLE_LIGHTER80 = "#ECE4FF"
!$PURPLE_LIGHTER60 = "#D9C9FF"
!$PURPLE_LIGHTER40 = "#C6AEFE"
!$PURPLE_DARKER25 = "#5F1BFD"
!$PURPLE_DARKER50 = "#3801BA"
!$BLUE = "#2E75B6"
!$CYBER_BLUE = "#2E75B6"
!$BLUE_LIGHTER80 = "#D2E4F4"
!$BLUE_LIGHTER60 = "#A5C8E8"
!$BLUE_LIGHTER40 = "#78ADDD"
!$BLUE_DARKER25 = "#235888"
!$BLUE_DARKER50 = "#173B5B"
!$ORANGE = "#E86600"
!$CYBER_ORANGE = "#FF8F37"
!$ORANGE_LIGHTER80 = "#FFE9D7"
!$ORANGE_LIGHTER60 = "#FFD2AF"
!$ORANGE_LIGHTER40 = "#FFBC87"
!$ORANGE_DARKER25 = "#E86600"
!$ORANGE_DARKER50 = "#9B4400"

!$BACKGROUND = "transparent"
!$PRIMARY = $BLUE_LIGHTER60
!$PRIMARY_LIGHTER = $BLUE_LIGHTER80
!$SECONDARY = $CYBER_BLUE
!$SECONDARY_LIGHTER = $BLUE_LIGHTER60
!$INFO_BG = $GREY
!$BORDER = $BLACK
!$BORDER_LIGHTER = $DARK_GREY
!$FONT = $BLACK
!$FONT_LIGHTER = $DARK_GREY
!$SUCCESS = $GREEN_DARKER50
!$DANGER = $RED_DARKER50
!$WARNING = $CYBER_ORANGE
!$INFO = $CYBER_BLUE

''
'' Called to make the text in the color of SUCCESS
''
!procedure $success($msg)
  &lt;font color=$SUCCESS&gt;&lt;b&gt;$msg
!endprocedure
''
'' Called to make the text in the color of DANGER
''
!procedure $failure($msg)
  &lt;font color=$DANGER&gt;&lt;b&gt;$msg
!endprocedure
''
'' Called to make the text in the color of WARNING
''
!procedure $warning($msg)
  &lt;font color=$WARNING&gt;&lt;b&gt;$msg
!endprocedure
''
'' Called to make the text in the color of INFO
''
!procedure $info($msg)
  &lt;font color=$INFO&gt;&lt;b&gt;$msg
!endprocedure


skinparam defaultFontName Inter
skinparam BackgroundColor $BACKGROUND
skinparam shadowing false
skinparam RoundCorner 7
skinparam ArrowColor $BLACK
skinparam FontColor $FONT

skinparam sequence {
    LifeLineBorderColor $BORDER_LIGHTER
    LifeLineBackgroundColor $PRIMARY_LIGHTER
    GroupHeaderFontColor $FONT
    GroupFontColor $FONT_LIGHTER
    GroupBorderColor $BORDER_LIGHTER
    GroupBorderThickness 1

    Divider {
        BorderColor $BORDER
        BorderThickness 1
        FontColor $FONT
    }
}

skinparam participant {
    BackgroundColor $PRIMARY
    BorderColor $BORDER
    FontColor $FONT
    BorderThickness 1.5
}

skinparam database {
    BackgroundColor $SECONDARY_LIGHTER
    BorderColor $BORDER
    FontColor $FONT
}

skinparam entity {
    BackgroundColor $PRIMARY_LIGHTER
    BorderColor $BORDER
    FontColor $FONT
}

skinparam note {
    BackgroundColor $INFO_BG
    BorderColor $BORDER
    FontColor $FONT
    BorderThickness 1.5
}

skinparam actor {
    BackgroundColor $BLACK
    BorderColor $BORDER
    FontColor $FONT
}

skinparam boundary {
    BackgroundColor $PRIMARY_LIGHTER
    BorderColor $BORDER
    FontColor $FONT
}

skinparam control {
    BackgroundColor $PRIMARY_LIGHTER
    BorderColor $BORDER
    FontColor $FONT
}

skinparam collections {
    BackgroundColor $PRIMARY
    BorderColor $BORDER
    FontColor $FONT
    BorderThickness 1.5
}

skinparam queue {
    BackgroundColor $PRIMARY
    BorderColor $BORDER
    FontColor $FONT
    BorderThickness 1.5
}
@startuml Dynamic Link Based Authentication Flow

hide footbox
autonumber
skinparam maxMessageSize 330
' maxMessageSize is in pixels, we don't need to manually add \n in the text
skinparam style strictuml
skinparam responseMessageBelowArrow true
skinparam sequenceMessageAlign center

title Dynamic Link Based Authentication Flow

participant "RP frontend" as rp_frontend
participant "RP backend" as rp
participant "RP API" as core
participant "App" as splitkey_app

activate rp_frontend
activate rp

note over rp_frontend
User initiates a login on the RP frontend
(website or mobile app). Inserting ID code is
optional depending on the RP setup.
end note

rp_frontend -&gt; rp : Request new login

note over rp
RP generates a randomChallenge
and sends it in the request.
end note

rp -&gt; core : ""POST /v3/authentication/dynamic-link/...""
activate core
rp &lt;-- core : ""sessionId"", ""sessionToken"", ""sessionSecret""

loop until user interacts
    rp_frontend -&gt; rp : Request for updated AuthCode
    rp_frontend &lt;-- rp : Provide updated AuthCode

    note over rp_frontend
    RP frontend shows one or more
    of the following to the user:
    * **QR code**,
    * **web2app link**,
    * **app2app link**.
    end note
end

rp_frontend -&gt; splitkey_app : User clicks on the same-device link or scans the QR code with the App
activate splitkey_app
splitkey_app -&gt; splitkey_app : App extracts the necessary\n parameters from the QR code,\n web2app link or app2app link

splitkey_app -&gt; core : ""createDynamicLinkBasedTransaction(...)""
splitkey_app &lt;-- core : ""transaction(...)""

splitkey_app -&gt; splitkey_app : Display authentication UI
note over splitkey_app
User has to enter the PIN code as usual (but the
verification code is not shown).
end note

loop until signature completed or error
        rp -&gt; core : ""GET session/:sessionId""
    alt signature pending
        rp &lt;-- core : ""session status""
    else error (or timeout)
        rp &lt;-- core : ""error""
    else signature completed
        splitkey_app -&gt; core : Signature
        deactivate splitkey_app
        rp &lt;-- core : ""result""
        deactivate core
    end
end

note over rp
The response contains serverRandom and the total
challenge, which was signed by the end user. RP
concatenates the randomChallenge from storage
with the serverRandom from response and verifies
that the provided signature is valid.
end note
rp_frontend &lt;-- rp  : User is authenticated

@enduml</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dynamic_link_calculation"><a class="anchor" href="#_dynamic_link_calculation"></a>Dynamic link calculation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When RP backend makes a request to RP API create a new dynamic link based session, Smart-ID server generates and returns the following parameters as a response:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sessionID</code> - session ID (RP UUID);</p>
</li>
<li>
<p><code>sessionToken</code> - unique random value that will be used to connect this login attempt between the relevant parties (RP, RP API, Smart-ID app);</p>
</li>
<li>
<p><code>sessionSecret</code> - unique random value that should be kept in secret and should be shared only between the RP backend and RP API server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>RP then starts calculating and showing the QR image, Web2App link, and/or App2App link dynamically (all those links must be updated regularly with the interval of 1 second).</p>
</div>
<div class="paragraph">
<p>The RP may offer multiple options (a QR image and a Web2App link) to the user at the same time. This is useful in the following situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user is accessing RP website from a mobile device, for example a tablet device. RP wants to offer to the user the choice to authenticate either on the same device (via a Web2App link) or on a separate device (via a dynamic QR code).</p>
</li>
<li>
<p>RP is unable to detect from the user agent whether the user is using a mobile device or a PC.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next table lists all of the parameters and definitions used in the dynamic link generation. They are all explained in more detail below.</p>
</div>
<table class="tableblock frame-none grid-none stripes-odd stretch">
<caption class="title">Parameters used for dynamic link generation</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Formula</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionToken</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(generated by RP API)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionSecret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(generated by RP API)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dynLinkType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'QR' | 'Web2App' | 'App2App'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'auth' | 'sign' | 'cert'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elapsedSeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds since receiving the response from the initial request to RP API</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dynLinkType.sessionType.time</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HMAC(<code>sessionSecret</code>, <code>payload</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">QR message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smartid:sessionToken=..?dynLinkType=..&amp;sessionType=..&amp;elapsedSeconds=..&amp;authCode=..</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The parameters for QR, web2app link and app2app link are the same except for the <code>dynLinkType</code> parameter, which contains one of the 3 possible values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'QR' (for QR codes)</p>
</li>
<li>
<p>'Web2App' (for Web2App links)</p>
</li>
<li>
<p>'App2App' (for App2App links)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The parameter <code>sessionType</code> describes the session type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'auth' - authentication session</p>
</li>
<li>
<p>'sign' - signing session</p>
</li>
<li>
<p>'cert' - certificate-choice session</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>elapsedSeconds</code> parameters is seconds since receiving the response from the initial request to RP API. Notice that <code>authCode</code> must be re-calculated every 1s.</p>
</div>
<div class="paragraph">
<p>As the next step, RP calculates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>payload</code> := <code>dynLinkType.sessionType.time</code></p>
</li>
<li>
<p><code>authCode</code> := HMACSHA256(<code>sessionSecret</code>, <code>payload</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Details about formatting the <code>payload</code> and <code>sessionSecret</code> parameters as byte strings for HMACSHA256 calculation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>payload</code> should be converted into a byte string from its ASCII string representation</p>
</li>
<li>
<p><code>sessionSecret</code> should be converted into a byte string from its ASCII string representation (as it is returned from RP-API as an ASCII string)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table aims to clarify which of the parameters should be accessible by which parties.</p>
</div>
<table class="tableblock frame-none grid-none stripes-odd stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top">RP-API server</th>
<th class="tableblock halign-center valign-top">RP backend</th>
<th class="tableblock halign-center valign-top">RP frontend/app</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionId</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/star-emoji-2B50.svg" alt="star emoji 2B50" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/no-entry-emoji-26D4.svg" alt="no entry emoji 26D4" width="40"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionToken</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/star-emoji-2B50.svg" alt="star emoji 2B50" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionSecret</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/star-emoji-2B50.svg" alt="star emoji 2B50" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/no-entry-emoji-26D4.svg" alt="no entry emoji 26D4" width="40"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elapsedSeconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/star-emoji-2B50.svg" alt="star emoji 2B50" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dynLinkType</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/star-emoji-2B50.svg" alt="star emoji 2B50" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionType</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/star-emoji-2B50.svg" alt="star emoji 2B50" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authCode</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/star-emoji-2B50.svg" alt="star emoji 2B50" width="40"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Legend:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="image"><img src="_images/star-emoji-2B50.svg" alt="star emoji 2B50" width="40"></span> - source of parameter (the party that generates/calculates it)</p>
</li>
<li>
<p><span class="image"><img src="_images/check-emoji-2714.svg" alt="check emoji 2714" width="40"></span> - knows parameter</p>
</li>
<li>
<p><span class="image"><img src="_images/no-entry-emoji-26D4.svg" alt="no entry emoji 26D4" width="40"></span> - MUST NOT know parameter</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_qr"><a class="anchor" href="#_qr"></a>QR</h3>
<div class="paragraph">
<p>QR message itself is defined as the following URI string:</p>
</div>
<div class="paragraph">
<p><code>smartid:<strong>session_token</strong>?dynLinkType=QR&amp;sessionType=<strong>session_type</strong>&amp;elapsedSeconds=<strong>elapsed_seconds</strong>&amp;authCode=<strong>authentication_code</strong></code></p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p><code>smartid:<strong>01fbf533-846d-4fc2-8b45-d8871a27912c</strong>?dynLinkType=<strong>QR</strong>&amp;sessionType=<strong>auth</strong>&amp;elapsedSeconds=<strong>2</strong>&amp;authCode=<strong>R5oiivdJIhfjJLBCA3AzijU2p8oH45fBKpcN59oSXboo</strong></code></p>
</div>
<div class="paragraph">
<p>Here parameter <code>authCode</code> is represented as a hexadecimal string. Parameter <code>sessionToken</code> is inserted into the QR message exactly as it was returned from RP-API.</p>
</div>
<div class="paragraph">
<p>Example of a QR code:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/qr.png" alt="qr" width="160">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_link"><a class="anchor" href="#_link"></a>Link</h3>
<div class="paragraph">
<p>The dynamic link for App2App and Web2App is similar to the QR URI string:</p>
</div>
<div class="paragraph">
<p><code>https://mobile-api.smart-id.com/?sessionToken=<strong>session_token</strong>&amp;dynLinkType=<strong>dyn_link_type</strong>&amp;sessionType=<strong>session_type</strong>&amp;elapsedSeconds=<strong>elapsed_seconds</strong>&amp;authCode=<strong>authCode</strong></code></p>
</div>
<div class="paragraph">
<p>Example of a Web2App link:</p>
</div>
<div class="paragraph">
<p><code>https://mobile-api.smart-id.com/?sessionToken=<strong>01fbf533-846d-4fc2-8b45-d8871a27912c</strong>&amp;dynLinkType=<strong>Web2App</strong>&amp;sessionType=<strong>auth</strong>&amp;elapsedSeconds=<strong>2</strong>&amp;authCode=<strong>R5oiivdJIhfjJLBCA3AzijU2p8oH45fBKpcN59oSXboo</strong></code></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For all flows, the dynamic generation (every 1s) of the <code>authCode</code> parameter must be done in the RP backend, <strong>NOT</strong> in the RP frontend or RP app so as not to not leak the <code>sessionSecret</code> parameter.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the App2App and Web2App flow it will be possible for the RP to also attach a callback URI that the Smart-ID App can call at the end of the transcation. This will allow for seamless navigation between RP apps and RP websites in the same-device use case.</p>
</div>
<div class="paragraph">
<p>Details for the this functionality are being worked on.</p>
</div>
<div class="paragraph">
<p>The callback URL will also be part of the <code>payload</code> and as such protected by the <code>authCode</code> parameter.</p>
</div>
<div class="paragraph">
<p>The allowed callback domains might be whitelisted by the Smart-ID Service.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dynamic_link_and_qr_presentation"><a class="anchor" href="#_dynamic_link_and_qr_presentation"></a>Dynamic link and QR presentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For generation of QR codes, error correction level <strong>LOW</strong> should be used. The QR code should have sufficient margins to enable quick scanning by the Smart-ID app. The optimal size for QR code is ~10 pixels per block when displayed on a PC, since:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Block sizes 5 pixels and less are too small for easy scanning (devices might have focus issues).</p>
</li>
<li>
<p>Block sizes 20 pixels and above are too big for convenient scanning.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When QR code is displayed on a mobile device, it is recommended to show the QR code as big as possible, up to 10 pixels per block.</p>
</div>
<div class="paragraph">
<p>The actual generation of the QR <em>image</em> can be done both in the backend or the frontend, as the underlying message in the QR code is essentially public information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In the App2App flow, it is not necessary to generate the link every second. Instead, the RP app can request a fresh link on-the-fly from the RP backend when the user clicks on a button in the RP app and navigate to it.
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
